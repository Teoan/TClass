(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67fd5c0f"],{1276:function(e,t,a){"use strict";var s=a("d784"),r=a("44e7"),i=a("825a"),n=a("1d80"),l=a("4840"),o=a("8aa5"),u=a("50c4"),d=a("14c3"),c=a("9263"),p=a("d039"),h=[].push,m=Math.min,f=4294967295,v=!p((function(){return!RegExp(f,"y")}));s("split",2,(function(e,t,a){var s;return s="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,a){var s=String(n(this)),i=void 0===a?f:a>>>0;if(0===i)return[];if(void 0===e)return[s];if(!r(e))return t.call(s,e,i);var l,o,u,d=[],p=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),m=0,v=new RegExp(e.source,p+"g");while(l=c.call(v,s)){if(o=v.lastIndex,o>m&&(d.push(s.slice(m,l.index)),l.length>1&&l.index<s.length&&h.apply(d,l.slice(1)),u=l[0].length,m=o,d.length>=i))break;v.lastIndex===l.index&&v.lastIndex++}return m===s.length?!u&&v.test("")||d.push(""):d.push(s.slice(m)),d.length>i?d.slice(0,i):d}:"0".split(void 0,0).length?function(e,a){return void 0===e&&0===a?[]:t.call(this,e,a)}:t,[function(t,a){var r=n(this),i=void 0==t?void 0:t[e];return void 0!==i?i.call(t,r,a):s.call(String(r),t,a)},function(e,r){var n=a(s,e,this,r,s!==t);if(n.done)return n.value;var c=i(e),p=String(this),h=l(c,RegExp),g=c.unicode,D=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(v?"y":"g"),b=new h(v?c:"^(?:"+c.source+")",D),I=void 0===r?f:r>>>0;if(0===I)return[];if(0===p.length)return null===d(b,p)?[p]:[];var U=0,w=0,x=[];while(w<p.length){b.lastIndex=v?w:0;var C,P=d(b,v?p:p.slice(w));if(null===P||(C=m(u(b.lastIndex+(v?0:w)),p.length))===U)w=o(p,w,g);else{if(x.push(p.slice(U,w)),x.length===I)return x;for(var k=1;k<=P.length-1;k++)if(x.push(P[k]),x.length===I)return x;w=U=C}}return x.push(p.slice(U)),x}]}),!v)},"44e7":function(e,t,a){var s=a("861d"),r=a("c6b6"),i=a("b622"),n=i("match");e.exports=function(e){var t;return s(e)&&(void 0!==(t=e[n])?!!t:"RegExp"==r(e))}},"50d8":function(e,t,a){"use strict";var s=a("bcd6"),r=a.n(s);r.a},a8c6:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"userinfo-div"},[a("el-card",{staticClass:"box-card-info",attrs:{shadow:"hover"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e.isEditOtherUserDate?a("span",[e._v("关于ta")]):a("span",[e._v("关于我")])]),a("div",[a("el-avatar",{attrs:{size:150,src:e.userInfo.avatarUrl}})],1),a("div",{staticClass:"user-name"},[e._v(" "+e._s(e.userInfo.name)+" ")]),a("div",{staticClass:"user-role-name border-bottom"},[e._v(" "+e._s(e.userInfo.role.zhName)+" ")]),a("div",{staticClass:"user-orther-info"},[a("div",{staticClass:"item border-bottom"},[a("span",[a("i",{staticClass:"fas fa-map-marker-alt"})]),e._v(" "+e._s(e.userInfo.nativePlace.replace(/[,]/g,""))+" ")]),a("div",{staticClass:"item border-bottom"},[a("span",[a("i",{staticClass:"fas fa-envelope"})]),e._v(" "+e._s(e.userInfo.email)+" ")]),a("div",{staticClass:"item border-bottom"},[a("span",[a("i",{staticClass:"fas fa-phone"})]),e._v(" "+e._s(e.userInfo.phone)+" ")]),a("div",{staticClass:"login-time"},[a("div",[e._v("上一次登录时间")]),a("div",[e._v(e._s(e.userInfo.loginTime))])])])]),a("el-card",{staticClass:"box-card-data",attrs:{shadow:"hover"}},[e.isEditOtherUserDate?e._e():a("el-tooltip",{attrs:{effect:"dark",content:"点击更换头像",placement:"top"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/student/avatar","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload,"on-error":e.handleAvatarError}},[e.userInfo.avatarUrl?a("img",{staticClass:"avatar",attrs:{src:e.userInfo.avatarUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("div",[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.userDataLoading,expression:"userDataLoading"}],ref:"userData",attrs:{model:e.userData,"label-width":"auto",rules:e.rules,inline:!0,"status-icon":!0}},[e.isEditOtherUserDate?a("el-form-item",{attrs:{label:"名字"}},[a("el-input",{staticClass:"input-width",model:{value:e.userData.name,callback:function(t){e.$set(e.userData,"name",t)},expression:"userData.name"}})],1):e._e(),e.isEditOtherUserDate?a("el-form-item",{attrs:{label:"权限"}},[a("el-select",{attrs:{placeholder:"请选择权限",filterable:""},model:{value:e.userData.roleId,callback:function(t){e.$set(e.userData,"roleId",t)},expression:"userData.roleId"}},e._l(e.roles,(function(e){return a("el-option",{key:e.id,attrs:{label:e.zhName,value:e.id}})})),1)],1):e._e(),a("el-form-item",{attrs:{label:"电话",prop:"phone"}},[a("el-input",{staticClass:"input-width",model:{value:e.userData.phone,callback:function(t){e.$set(e.userData,"phone",t)},expression:"userData.phone"}})],1),a("el-form-item",{attrs:{label:"籍贯"}},[a("el-cascader",{staticClass:"input-width",attrs:{options:e.options},model:{value:e.selectedNativePlaceOptions,callback:function(t){e.selectedNativePlaceOptions=t},expression:"selectedNativePlaceOptions"}})],1),a("el-form-item",{attrs:{label:"邮箱地址",prop:"email"}},[a("el-input",{staticClass:"input-width",model:{value:e.userData.email,callback:function(t){e.$set(e.userData,"email",t)},expression:"userData.email"}})],1),a("el-form-item",{attrs:{label:"民族"}},[a("el-select",{attrs:{placeholder:"请选择民族",filterable:""},model:{value:e.userData.nationId,callback:function(t){e.$set(e.userData,"nationId",t)},expression:"userData.nationId"}},e._l(e.nations,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"政治面貌"}},[a("el-select",{attrs:{placeholder:"请选择政治面貌",filterable:""},model:{value:e.userData.politicId,callback:function(t){e.$set(e.userData,"politicId",t)},expression:"userData.politicId"}},e._l(e.politicsStatusList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"性别"}},[a("el-select",{attrs:{placeholder:"请选择性别"},model:{value:e.userData.gender,callback:function(t){e.$set(e.userData,"gender",t)},expression:"userData.gender"}},[a("el-option",{attrs:{label:"男",value:"男"}}),a("el-option",{attrs:{label:"女",value:"女"}})],1)],1),e.isEditOtherUserDate?a("el-form-item",{attrs:{label:"校内职务"}},[a("el-select",{attrs:{placeholder:"校内职务"},model:{value:e.userData.posId,callback:function(t){e.$set(e.userData,"posId",t)},expression:"userData.posId"}},e._l(e.positions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),a("el-form-item",{attrs:{label:"校内部门"}},[a("el-select",{staticStyle:{width:"600px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:e.userData.departmentIdList,callback:function(t){e.$set(e.userData,"departmentIdList",t)},expression:"userData.departmentIdList"}},e._l(e.departments,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})),1)],1),a("div",[a("el-form-item",{attrs:{label:"家庭住址"}},[a("el-input",{staticClass:"address-textarea",attrs:{type:"textarea",autosize:{minRows:2,maxRows:4}},model:{value:e.userData.address,callback:function(t){e.$set(e.userData,"address",t)},expression:"userData.address"}})],1)],1),a("div",{staticClass:"submit-btn"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("userData")}}},[e._v("修改资料")])],1)],1),e.isEditOtherUserDate?e._e():a("el-divider"),e.isEditOtherUserDate?e._e():a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.passDataLoading,expression:"passDataLoading"}],ref:"passData",attrs:{"label-width":"auto",model:e.pass,rules:e.rules}},[a("el-form-item",{attrs:{label:"新密码",prop:"password"}},[a("el-input",{staticClass:"input-width",attrs:{type:"password",autocomplete:"off"},model:{value:e.pass.password,callback:function(t){e.$set(e.pass,"password",t)},expression:"pass.password"}})],1),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPassword"}},[a("el-input",{staticClass:"input-width",attrs:{type:"password",autocomplete:"off"},model:{value:e.pass.checkPassword,callback:function(t){e.$set(e.pass,"checkPassword",t)},expression:"pass.checkPassword"}})],1),a("el-form-item",{staticClass:"submit-btn"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("passData")}}},[e._v("修改密码")])],1)],1)],1)],1)],1)},r=[],i=(a("baa5"),a("b0c0"),a("ac1f"),a("1276"),a("ef6c")),n={data:function(){var e=this,t=function(t,a,s){""===a?s(new Error("请输入密码")):(""!==e.pass.checkPassword&&e.$refs.passData.validateField("checkPass"),s())},a=function(t,a,s){""===a?s(new Error("请再次输入密码")):a!==e.pass.password?s(new Error("两次输入密码不一致!")):s()};return{userData:{id:null,name:null,gender:null,nationId:null,politicId:null,email:null,phone:null,address:null,nativePlace:null,posId:null,roleId:null,departmentIdList:[]},userInfo:{name:null,email:null,phone:null,nativePlace:null,loginTime:null,role:{zhName:null},avatarUrl:null},isEditOtherUserDate:void 0!==this.$route.query.id,rules:{email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phone:[{pattern:/^1[3|4|5|7|8][0-9]\d{8}$/,message:"请输入正确的电话号码",trigger:["blur","change"]}],password:[{validator:t,trigger:"blur"},{min:6,message:"密码最少为6位",trigger:"blur"}],checkPassword:[{validator:a,trigger:"blur"}]},userDataLoading:!1,passDataLoading:!1,userDepartmentList:[],nations:[],departments:[],politicsStatusList:[],positions:[],roles:[],pass:{password:"",checkPassword:""},options:i["regionData"],selectedNativePlaceOptions:[]}},computed:{currentUser:function(){return void 0!==this.$store.state.currentUser.role?this.$store.state.currentUser:JSON.parse(localStorage.getItem("INIT_CURRENTUSER"))}},created:function(){this.initUserData(),this.getNations(),this.getDepartments(),this.getpoliticsStatusList(),this.getPositions(),this.getRoles()},methods:{getNations:function(){var e=this;this.getRequest("/student/nations").then((function(t){0===t.code&&(e.nations=t.data)}))},getDepartments:function(){var e=this;this.getRequest("/student/departments").then((function(t){0===t.code&&(e.departments=t.data)}))},getpoliticsStatusList:function(){var e=this;this.getRequest("/student/political").then((function(t){0===t.code&&(e.politicsStatusList=t.data)}))},getPositions:function(){var e=this;this.getRequest("/student/positions").then((function(t){0===t.code&&(e.positions=t.data)}))},getRoles:function(){var e=this;this.getRequest("/student/roles").then((function(t){0===t.code&&(e.roles=t.data)}))},nativePlaceCodeToText:function(){var e="";for(var t in this.selectedNativePlaceOptions)e=e+i["CodeToText"][this.selectedNativePlaceOptions[t]]+",";this.userData.nativePlace=e.substring(0,e.lastIndexOf(","))},nativePlaceTextToCode:function(){var e=[],t=this.userData.nativePlace.split(",");e[0]=i["TextToCode"][t[0]].code,e[1]=i["TextToCode"][t[0]][t[1]].code,e[2]=i["TextToCode"][t[0]][t[1]][t[2]].code,this.selectedNativePlaceOptions=e},initUserData:function(){var e=this;this.isEditOtherUserDate?this.getRequest("/student/"+this.$route.query.id).then((function(t){0===t.code&&(e.userInfo.name=t.data.name,e.userInfo.email=t.data.email,e.userInfo.phone=t.data.phone,e.userInfo.nativePlace=t.data.nativePlace,e.userInfo.loginTime=t.data.loginTime,e.userInfo.role=t.data.role,e.userInfo.avatarUrl=t.data.avatarUrl,e.userData.id=t.data.id,e.userData.name=t.data.name,e.userData.roleId=t.data.roleId,e.userData.gender=t.data.gender,e.userData.nationId=t.data.nationId,e.userData.politicId=t.data.politicId,e.userData.posId=t.data.posId,e.userData.email=t.data.email,e.userData.phone=t.data.phone,e.userData.address=t.data.address,e.userData.nativePlace=t.data.nativePlace,e.userData.departmentIdList=t.data.departmentIdList,e.nativePlaceTextToCode())})):(this.userInfo.name=this.currentUser.name,this.userInfo.email=this.currentUser.email,this.userInfo.phone=this.currentUser.phone,this.userInfo.nativePlace=this.currentUser.nativePlace,this.userInfo.loginTime=this.currentUser.loginTime,this.userInfo.role=this.currentUser.role,this.userInfo.avatarUrl=this.currentUser.avatarUrl,this.userData.id=this.currentUser.id,this.userData.gender=this.currentUser.gender,this.userData.nationId=this.currentUser.nationId,this.userData.politicId=this.currentUser.politicId,this.userData.email=this.currentUser.email,this.userData.phone=this.currentUser.phone,this.userData.address=this.currentUser.address,this.userData.nativePlace=this.currentUser.nativePlace,this.userData.departmentIdList=this.currentUser.departmentIdList,this.nativePlaceTextToCode())},submitForm:function(e){var t=this;this.$refs[e].validate((function(a){if(!a)return console.log("error submit!!"),!1;"userData"===e?(t.userDataLoading=!0,t.nativePlaceCodeToText(),t.isEditOtherUserDate?t.putRequest("/admin/student/",t.userData).then((function(e){0===e.code&&(t.$message.success("资料修改成功！"),t.userDataLoading=!1)})).catch((function(e){t.userDataLoading=!1,console.log(e)})):t.putRequest("/student/",t.userData).then((function(e){0===e.code&&(t.$message.success("资料修改成功！"),t.userDataLoading=!1,t.$store.commit("INIT_CURRENTUSER",e.data),t.userInfo=e.data)})).catch((function(e){t.userDataLoading=!1,console.log(e)}))):"passData"===e&&(t.passDataLoading=!0,t.putRequest("/student/reSetPassword/"+t.userData.id).then((function(e){0===e.code&&e.data&&(t.$message.success("密码修改成功！"),t.passDataLoading=!1,t.pass.password="",t.pass.checkPassword="")})).catch((function(e){t.passDataLoading=!1,console.log(e)})))}))},handleAvatarSuccess:function(e,t){var a=this;this.getRequest("/student/"+this.currentUser.id).then((function(e){0===e.code&&(a.$store.commit("INIT_CURRENTUSER",e.data),localStorage.setItem("INIT_CURRENTUSER",JSON.stringify(e.data)),a.userInfo.avatarUrl=e.data.avatarUrl+"?count="+Math.random(),a.$message.success("头像修改成功！"))})).catch((function(e){console.log(e)}))},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type,a=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是 JPG 格式!"),a||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&a},handleAvatarError:function(e,t,a){e=JSON.parse(e.message),this.$message.error(e.message)}}},l=n,o=(a("50d8"),a("2877")),u=Object(o["a"])(l,s,r,!1,null,"54688482",null);t["default"]=u.exports},bcd6:function(e,t,a){}}]);
//# sourceMappingURL=chunk-67fd5c0f.2d43f045.js.map